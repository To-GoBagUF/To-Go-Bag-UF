<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>To-Go Bag UF</title>
<style>
  :root{
    --navy:#001f3f; --white:#fff; --muted:#6b879a; --accent:#00b22d; --radius:12px;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;color:var(--navy);background:var(--white)}
  header{background:var(--navy);color:var(--white);padding:28px 20px;text-align:center}
  header .top{display:flex;align-items:center;gap:16px;justify-content:center;flex-wrap:wrap}
  header img.logo{height:64px;object-fit:contain;display:block}
  header h1{margin:0;font-size:28px}
  header p{margin:6px 0 10px;font-size:15px}
  .header-note{font-size:14px;opacity:0.95;margin-bottom:10px}
  .header-buttons{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:6px}
  .btn{padding:10px 18px;border-radius:10px;font-size:15px;border:0;cursor:pointer;transition:transform .14s,box-shadow .14s}
  .btn-primary{background:var(--white);color:var(--navy);font-weight:700;box-shadow:0 6px 18px rgba(0,0,0,0.12)}
  .btn-secondary{background:transparent;color:var(--white);border:2px solid rgba(255,255,255,0.12)}
  .preorder{background:var(--navy);color:var(--white);text-align:center;padding:10px;font-weight:700}
  main{max-width:1100px;margin:28px auto;padding:0 20px}
  section{display:none;padding:36px 0}
  .section-inner{max-width:900px;margin:0 auto}
  h2{margin:0 0 10px;font-size:22px}
  p.lead{margin:0 0 12px;color:#073049}
  .product-card{display:grid;grid-template-columns:1fr 320px;gap:20px;align-items:start}
  .prod-visual{background:#f4f9ff;border-radius:14px;padding:16px;text-align:center}
  label{display:block;margin:8px 0 6px;font-weight:700;color:#00314f}
  select,input[type="text"],input[type="email"],input[type="number"]{width:100%;padding:10px;border-radius:8px;border:1px solid #cfe0ef;font-size:15px}
  .muted{color:var(--muted);font-size:14px}
  footer{background:var(--navy);color:var(--white);padding:18px;text-align:center;display:flex;align-items:center;justify-content:center;gap:10px;flex-wrap:wrap}
  footer img.logo-small{height:36px}
  #cartIcon{position:fixed;right:18px;bottom:18px;background:var(--navy);color:white;padding:10px 12px;border-radius:999px;z-index:1500;cursor:pointer;box-shadow:0 8px 26px rgba(0,0,0,0.18)}
  /* modals */
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;justify-content:center;align-items:center;z-index:1600;opacity:0;pointer-events:none;transition:opacity .22s}
  .modal-backdrop.open{opacity:1;pointer-events:auto}
  .modal{width:100%;max-width:520px;max-height:88vh;overflow-y:auto;background:#fff;border-radius:var(--radius);padding:20px;box-shadow:0 18px 48px rgba(0,0,0,0.2);transform:translateY(-18px);transition:transform .22s;position:relative}
  .modal-backdrop.open .modal{transform:translateY(0)}
  .closeX{position:absolute;right:16px;top:10px;cursor:pointer;color:#666;font-size:18px}
  .cart-item{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:10px}
  .summary{background:#f7fbff;padding:12px;border-radius:10px;margin-top:12px}
  @media (max-width:900px){.product-card{grid-template-columns:1fr}.prod-visual{order:-1}.modal{max-width:95%;padding:14px;max-height:85vh}}
  .pay-btn{background:var(--accent);color:white;font-weight:700;width:100%;padding:12px;border:0;border-radius:10px;font-size:16px;margin-top:10px}
  .pay-btn:active{transform:scale(.99)}
  .small{font-size:13px;color:#5b6f80}
  .logo-in-confirm{height:80px;display:block;margin:8px auto}
</style>
</head>
<body>

<header>
  <div class="top">
    <!-- logo.png must be uploaded to the same folder as this file -->
    <img src="logo.png" alt="To-Go Bag logo" class="logo" />
  </div>
  <h1>To-Go Bag UF</h1>
  <p>F√∂r alla sm√• kriser i livet ‚Äì vi packade v√§skan √•t dig üòâ</p>
  <div class="header-note">Klicka p√• <strong>Produkt</strong> h√§r ovan f√∂r att se och best√§lla.</div>
  <div class="header-buttons">
    <button class="btn btn-primary" onclick="showSection('product')">Produkt</button>
    <button class="btn btn-secondary" onclick="showSection('contact')">Kontakt</button>
  </div>
</header>

<div class="preorder">Just nu f√∂rbest√§llning</div>

<main>
  <section id="home">
    <div class="section-inner">
      <h2>V√§lkommen</h2>
      <p class="lead">To-Go Bag ‚Äî en smart n√∂dv√§ska f√∂r vardagens sm√• kriser. Klicka p√• Produkt f√∂r att best√§lla.</p>
    </div>
  </section>

  <section id="product">
    <div class="section-inner">
      <h2>The To-Go Bag</h2>
      <p class="lead">En liten v√§ska med handsprit, pl√•ster, h√•rsnoddar, binda/tampong, m√ºslibar, tuggummi och v√•tservetter.</p>

      <div class="product-card">
        <div>
          <p style="font-weight:800;margin:0 0 8px">The To-Go Bag</p>
          <p class="muted">Perfekt f√∂r skolan, festen eller n√§r du √§r p√• spr√•ng.</p>

          <div style="margin-top:14px">
            <label for="variantSelect">Variant</label>
            <select id="variantSelect">
              <option value="Binda/Tampong">Binda/Tampong</option>
              <option value="Herr">Herr</option>
            </select>

            <div id="subVariantWrap" style="margin-top:10px">
              <label for="subVariantSelect">V√§lj</label>
              <select id="subVariantSelect">
                <option value="Binda">Binda</option>
                <option value="Tampong">Tampong</option>
              </select>
            </div>

            <div style="margin-top:10px">
              <label for="colorSelect">F√§rg</label>
              <select id="colorSelect">
                <option value="Bl√•">Bl√•</option>
                <option value="Rosa">Rosa</option>
                <option value="Svart">Svart</option>
                <option value="Vit">Vit</option>
              </select>
            </div>

            <div style="margin-top:14px;display:flex;gap:12px;align-items:center">
              <button id="orderBtn" class="btn btn-primary">L√§gg i varukorg ‚Äì 85 kr</button>
              <div class="muted">Pris/st: <strong>85 kr</strong></div>
            </div>
            <div class="small">Variant &amp; val inkluderas i orderbekr√§ftelsen och Swish-meddelandet.</div>
          </div>
        </div>

        <div class="prod-visual">
          <div style="height:220px;display:flex;align-items:center;justify-content:center;color:#234;font-weight:700">Produktbild</div>
          <div style="margin-top:12px;font-weight:800;color:var(--navy)">85 kr</div>
        </div>
      </div>
    </div>
  </section>

  <section id="about">
    <div class="section-inner">
      <h2>Om oss</h2>
      <p class="lead">Vi √§r ett UF-f√∂retag som vill g√∂ra vardagen enklare med genomt√§nkta n√∂dv√§skor.</p>
    </div>
  </section>

  <section id="contact">
    <div class="section-inner">
      <h2>Kontakt</h2>
      <p>Mejla oss p√• <a href="mailto:togobaguf@gmail.com">togobaguf@gmail.com</a></p>
    </div>
  </section>
</main>

<!-- cart icon -->
<div id="cartIcon" title="Varukorg" onclick="openCart()">üõí <span id="cartCount">0</span></div>

<!-- CART MODAL -->
<div id="cartModalBackdrop" class="modal-backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true">
    <span class="closeX" id="closeCartBtn">&times;</span>
    <h3 style="margin-top:6px">Din varukorg</h3>
    <div id="cartContentArea" style="margin-top:12px"></div>
    <div style="display:flex;gap:10px;margin-top:14px">
      <button class="btn btn-secondary" onclick="closeCart()" style="flex:1">Forts√§tt handla</button>
      <button class="btn btn-primary" onclick="openCheckout()" style="flex:1">F√∂rbest√§ll / Checkout</button>
    </div>
  </div>
</div>

<!-- CHECKOUT MODAL -->
<div id="checkoutModalBackdrop" class="modal-backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true">
    <span class="closeX" id="closeCheckoutBtn">&times;</span>
    <img src="logo.png" alt="logo" class="logo-in-confirm" />
    <h3 style="margin-top:6px">Slutf√∂r best√§llning</h3>

    <form id="checkoutForm" style="margin-top:12px" onsubmit="return false;">
      <label for="name">Namn</label>
      <input id="name" type="text" required>

      <label for="email">E-post</label>
      <input id="email" type="email" required>

      <label for="phone">Telefonnummer (valfritt)</label>
      <input id="phone" type="text">

      <label for="address">Adress</label>
      <input id="address" type="text" required>

      <label for="postal">Postnummer</label>
      <input id="postal" type="text" required>

      <label for="city">Stad</label>
      <input id="city" type="text" required>

      <label for="shipping">Fraktmetod</label>
      <select id="shipping">
        <option value="Standard">Standard</option>
        <option value="Express">Express</option>
      </select>

      <!-- hidden fields -->
      <select id="variant" style="display:none"></select>
      <select id="subVariant" style="display:none"></select>
      <select id="color" style="display:none"></select>
      <input id="quantityCheckout" type="number" style="display:none" value="1">

      <div class="summary" id="checkoutSummary">
        <div><strong>Produkt:</strong> <span id="summaryProduct">-</span></div>
        <div><strong>Antal:</strong> <span id="summaryQuantity">1</span></div>
        <div style="margin-top:8px"><strong>Totalt:</strong> <span id="summaryTotal">85</span> kr</div>
      </div>

      <button type="button" class="pay-btn" id="submitOrderBtn" onclick="submitOrder()">üí∏ Betala & F√∂rbest√§ll</button>

      <div style="margin-top:8px; text-align:center">
        <button type="button" id="manualSwishBtn" style="display:none;padding:8px 12px;border-radius:8px;border:1px solid #d6e9f7;background:#f8fbff;color:var(--navy);cursor:pointer">√ñppna Swish manuellt</button>
      </div>
    </form>
  </div>
</div>

<footer>
  <img src="logo.png" alt="logo" class="logo-small" style="height:36px">
  <div>¬© 2025 To-Go Bag UF ‚Äî Kontakt: <a style="color:#e6f2ff" href="mailto:togobaguf@gmail.com">togobaguf@gmail.com</a></div>
</footer>

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
/* ---------- KONFIG ---------- */
emailjs.init("ZUlGUNzP7Tqxg-LkD"); // public key
const EMAIL_SERVICE = "service_obk5jf2";
const EMAIL_TEMPLATE = "template_kj9rgm7";
const SWISH_NUMBER = "0764134947";
const PRICE = 85;

/* ---------- INIT ---------- */
document.addEventListener('DOMContentLoaded', () => {
  showSection('home');
  document.getElementById('variantSelect').addEventListener('change', updateSubVariantVisibility);
  updateSubVariantVisibility();

  document.getElementById('closeCartBtn').addEventListener('click', closeCart);
  document.getElementById('closeCheckoutBtn').addEventListener('click', closeCheckout);

  document.getElementById('cartModalBackdrop').addEventListener('click', (e)=>{ if(e.target === document.getElementById('cartModalBackdrop')) closeCart(); });
  document.getElementById('checkoutModalBackdrop').addEventListener('click', (e)=>{ if(e.target === document.getElementById('checkoutModalBackdrop')) closeCheckout(); });

  // manual swish button handler
  document.getElementById('manualSwishBtn').addEventListener('click', function(){
    if(window._lastSwishUrl) window.open(window._lastSwishUrl, '_blank');
  });
});

/* ---------- SECTIONS ---------- */
function showSection(id){
  document.querySelectorAll('main section').forEach(s=>s.style.display='none');
  const sec = document.getElementById(id);
  if(sec) sec.style.display='block';
}

/* ---------- VARIANT ---------- */
function updateSubVariantVisibility(){
  const v = document.getElementById('variantSelect').value;
  document.getElementById('subVariantWrap').style.display = (v === 'Binda/Tampong') ? 'block' : 'none';
}

/* ---------- CART ---------- */
let cart = { quantity:0, variant:null, subVariant:null, color:null };

document.getElementById('orderBtn').addEventListener('click', ()=>{
  const variant = document.getElementById('variantSelect').value;
  const subVariant = (variant === 'Binda/Tampong') ? document.getElementById('subVariantSelect').value : '';
  const color = document.getElementById('colorSelect').value;
  cart = { quantity:1, variant, subVariant, color };
  document.getElementById('cartCount').textContent = cart.quantity;
  renderCart();
  openCart();
});

function renderCart(){
  const area = document.getElementById('cartContentArea');
  if(!cart || cart.quantity <= 0){ area.innerHTML = "<p>Din varukorg √§r tom.</p>"; return; }
  const subTxt = cart.subVariant ? ` (${cart.subVariant})` : '';
  area.innerHTML = `
    <div class="cart-item">
      <div>
        <div style="font-weight:700">The To-Go Bag</div>
        <div class="muted">Variant: ${cart.variant}${subTxt}</div>
        <div class="muted">F√§rg: ${cart.color}</div>
      </div>
      <div style="text-align:right">
        <label for="cartQty">Antal</label>
        <input id="cartQty" type="number" value="${cart.quantity}" min="1" style="width:80px;padding:6px;border-radius:6px;border:1px solid #d9e9fb">
        <div style="margin-top:8px;font-weight:700">${PRICE * cart.quantity} kr</div>
      </div>
    </div>
    <div class="muted" style="margin-top:8px">√Ñndra antal f√∂r att uppdatera totalsumma.</div>
  `;
  document.getElementById('cartQty').addEventListener('input',(e)=>{
    let q = parseInt(e.target.value); if(isNaN(q) || q < 1) q = 1;
    cart.quantity = q; document.getElementById('cartCount').textContent = cart.quantity; renderCart();
  });
}

function openCart(){ renderCart(); document.getElementById('cartModalBackdrop').classList.add('open'); }
function closeCart(){ document.getElementById('cartModalBackdrop').classList.remove('open'); }
function openCheckout(){
  if(!cart || cart.quantity <= 0){ alert("Din varukorg √§r tom."); return; }
  document.getElementById('variant').value = cart.variant || '';
  document.getElementById('subVariant').value = cart.subVariant || '';
  document.getElementById('color').value = cart.color || '';
  document.getElementById('quantityCheckout').value = cart.quantity || 1;
  document.getElementById('summaryProduct').textContent = `${cart.variant}${cart.subVariant ? ' ('+cart.subVariant+')' : ''} ‚Äî ${cart.color}`;
  document.getElementById('summaryQuantity').textContent = cart.quantity;
  document.getElementById('summaryTotal').textContent = PRICE * cart.quantity;
  closeCart();
  document.getElementById('checkoutModalBackdrop').classList.add('open');
}
function closeCheckout(){ document.getElementById('checkoutModalBackdrop').classList.remove('open'); }

/* ---------- ORDER: EmailJS + Swish ---------- */
function submitOrder(){
  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const address = document.getElementById('address').value.trim();
  const postal = document.getElementById('postal').value.trim();
  const city = document.getElementById('city').value.trim();
  const shipping = document.getElementById('shipping').value;
  const variant = document.getElementById('variant').value;
  const subVariant = document.getElementById('subVariant').value;
  const color = document.getElementById('color').value;
  const quantity = parseInt(document.getElementById('quantityCheckout').value) || 1;
  const total = PRICE * quantity;

  if(!name || !email || !address || !postal || !city){
    alert("Fyll i alla obligatoriska f√§lt: namn, e-post, adress, postnummer och stad.");
    return;
  }

  // prepare template params, include logo url so email template can use it
  const logo_url = `${window.location.origin}/logo.png`;
  const params = { name, email, phone, address, postal, city, shipping, variant, subVariant, color, quantity, total, logo_url };

  // disable to avoid double clicks
  const btn = document.getElementById('submitOrderBtn');
  btn.disabled = true; btn.textContent = "Skickar...";

  emailjs.send(EMAIL_SERVICE, EMAIL_TEMPLATE, params).then(()=>{
    // show confirmation view (with logo)
    const modal = document.querySelector('#checkoutModalBackdrop .modal');
    modal.innerHTML = `
      <span class="closeX" onclick="closeCheckout()">&times;</span>
      <img src="logo.png" alt="logo" style="height:80px;display:block;margin:8px auto" />
      <h3>Tack! Din best√§llning √§r mottagen</h3>
      <div style="margin-top:10px">
        <p><strong>Namn:</strong> ${escapeHtml(name)}</p>
        <p><strong>E-post:</strong> ${escapeHtml(email)}</p>
        ${phone ? `<p><strong>Telefon:</strong> ${escapeHtml(phone)}</p>` : ''}
        <p><strong>Adress:</strong> ${escapeHtml(address)}, ${escapeHtml(postal)} ${escapeHtml(city)}</p>
        <p><strong>Frakt:</strong> ${escapeHtml(shipping)}</p>
        <p><strong>Produkt:</strong> ${escapeHtml(variant)} ${subVariant ? '('+escapeHtml(subVariant)+')' : ''} ‚Äî ${escapeHtml(color)}</p>
        <p><strong>Antal:</strong> ${quantity}</p>
        <p><strong>Total:</strong> ${total} kr</p>
        <p style="margin-top:12px">Nu √∂ppnar vi Swish (funkar endast p√• mobil). Om Swish inte √∂ppnas automatiskt, klicka p√• knappen nedan.</p>
        <div style="margin-top:12px">
          <button id="manualSwishLink" style="background:#0b6bff;color:#fff;padding:10px 14px;border-radius:8px;border:0;cursor:pointer">√ñppna Swish manuellt</button>
        </div>
      </div>
    `;

    // attempt to open Swish app (mobile) and set manual fallback link
    tryOpenSwish(total, variant, subVariant, color);

    // reset cart & UI
    cart = { quantity:0, variant:null, subVariant:null, color:null };
    document.getElementById('cartCount').textContent = 0;
    btn.disabled = false; btn.textContent = "üí∏ Betala & F√∂rbest√§ll";
  }, (err)=>{
    console.error(err);
    alert("Ett fel uppstod vid skickande av best√§llning. F√∂rs√∂k igen.");
    btn.disabled = false; btn.textContent = "üí∏ Betala & F√∂rbest√§ll";
  });
}

/* Try to open Swish; provide fallback web link and manual button */
function tryOpenSwish(amount, variant, subVariant, color){
  const message = encodeURIComponent(`To-Go Bag (${variant}${subVariant ? ', '+subVariant : ''}, ${color}) f√∂rbest√§llning`);
  const callback = encodeURIComponent(window.location.href);
  const swishApp = `swish://paymentrequest?token=1&callbackurl=${callback}&payee=${SWISH_NUMBER}&amount=${amount}&message=${message}`;
  const swishWeb = `https://swish.nu/?number=${SWISH_NUMBER}&amount=${amount}&text=${message}`;

  // save fallback url for manual open button
  window._lastSwishUrl = swishWeb;

  // If on mobile, try to open app
  if(/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)){
    // try to open using location change
    const now = Date.now();
    window.location.href = swishApp;

    // If app doesn't open within timeout, open web fallback in new tab (short delay)
    setTimeout(()=> {
      if(Date.now() - now < 3000){
        // still here -> open web fallback in new tab so user can continue
        window.open(swishWeb,'_blank');
      }
    }, 1200);
  } else {
    // desktop users: show manual swish button (in checkout modal and enable manual button)
    const manual = document.getElementById('manualSwishBtn');
    if(manual) manual.style.display = 'inline-block';
    alert("Swish kan bara √∂ppnas automatiskt p√• mobil. √ñppna sidan p√• mobilen f√∂r att betala eller anv√§nd l√§nken som √∂ppnas i ny flik.");
    // open fallback web page in new tab
    window.open(swishWeb,'_blank');
  }
}

/* utilities */
function escapeHtml(unsafe){
  if(!unsafe) return '';
  return String(unsafe)
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;')
    .replace(/'/g,'&#039;');
}
</script>
</body>
</html>
