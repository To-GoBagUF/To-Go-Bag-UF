<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>To-Go Bag UF</title>
<style>
  :root{
    --navy:#001f3f;
    --white:#ffffff;
    --muted:#6b879a;
    --accent:#00b22d;
    --radius:12px;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;color:var(--navy);background:var(--white);-webkit-font-smoothing:antialiased}
  header{background:var(--navy);color:var(--white);padding:24px 16px;text-align:center}
  header .top{display:flex;align-items:center;gap:12px;justify-content:center;flex-wrap:wrap}
  header img.logo{height:56px;object-fit:contain;display:block}
  header h1{margin:0;font-size:24px}
  header p{margin:6px 0 8px;font-size:14px}
  .header-note{font-size:13px;opacity:0.95;margin-bottom:8px}
  .header-buttons{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:6px}
  .btn{padding:10px 16px;border-radius:10px;font-size:15px;border:0;cursor:pointer;transition:transform .14s,box-shadow .14s}
  .btn-primary{background:var(--white);color:var(--navy);font-weight:700;box-shadow:0 6px 18px rgba(0,0,0,0.12)}
  .btn-secondary{background:transparent;color:var(--white);border:2px solid rgba(255,255,255,0.12)}
  .preorder{background:var(--navy);color:var(--white);text-align:center;padding:10px;font-weight:700}
  main{max-width:1100px;margin:28px auto;padding:0 18px}
  section{display:none;padding:36px 0}
  .section-inner{max-width:960px;margin:0 auto}
  h2{margin:0 0 10px;font-size:22px}
  p.lead{margin:0 0 12px;color:#073049}
  .product-card{display:grid;grid-template-columns:1fr 320px;gap:20px;align-items:start}
  .prod-visual{background:#f4f9ff;border-radius:14px;padding:16px;text-align:center}
  label{display:block;margin:8px 0 6px;font-weight:700;color:#00314f}
  select,input[type="text"],input[type="email"],input[type="number"]{width:100%;padding:10px;border-radius:8px;border:1px solid #cfe0ef;font-size:15px}
  .muted{color:var(--muted);font-size:14px}
  footer{background:var(--navy);color:var(--white);padding:14px;text-align:center;display:flex;align-items:center;justify-content:center;gap:10px;flex-wrap:wrap}
  footer img.logo-small{height:36px}
  #cartIcon{position:fixed;right:16px;bottom:16px;background:var(--navy);color:white;padding:10px 12px;border-radius:999px;z-index:1500;cursor:pointer;box-shadow:0 8px 26px rgba(0,0,0,0.18)}
  /* modals */
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;justify-content:center;align-items:center;z-index:1600;opacity:0;pointer-events:none;transition:opacity .22s}
  .modal-backdrop.open{opacity:1;pointer-events:auto}
  .modal{width:100%;max-width:520px;max-height:88vh;overflow-y:auto;background:#fff;border-radius:var(--radius);padding:18px;box-shadow:0 18px 48px rgba(0,0,0,0.2);transform:translateY(-18px);transition:transform .22s;position:relative}
  .modal-backdrop.open .modal{transform:translateY(0)}
  .closeX{position:absolute;right:12px;top:8px;cursor:pointer;color:#666;font-size:18px}
  .cart-item{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px;border-bottom:1px solid #eef6ff;padding-bottom:10px}
  .summary{background:#f7fbff;padding:12px;border-radius:10px;margin-top:12px}
  @media (max-width:900px){.product-card{grid-template-columns:1fr}.prod-visual{order:-1}.modal{max-width:95%;padding:14px;max-height:85vh}}
  .pay-btn{background:var(--accent);color:white;font-weight:700;width:100%;padding:12px;border:0;border-radius:10px;font-size:16px;margin-top:10px}
  .pay-btn:active{transform:scale(.99)}
  .small{font-size:13px;color:#5b6f80}
  .logo-in-confirm{height:80px;display:block;margin:8px auto}
  .qty-input{width:70px;padding:6px;border-radius:6px;border:1px solid #d9e9fb}
  .remove-btn{background:transparent;border:0;color:#c0392b;cursor:pointer}
</style>
</head>
<body>

<header>
  <div class="top">
    <img src="logo.png" alt="To-Go Bag logo" class="logo" />
  </div>
  <h1>To-Go Bag UF</h1>
  <p>F√∂r alla sm√• kriser i livet ‚Äì vi packade v√§skan √•t dig üòâ</p>
  <div class="header-note">Klicka p√• <strong>Produkt</strong> h√§r ovan f√∂r att se och best√§lla.</div>
  <div class="header-buttons">
    <button class="btn btn-primary" onclick="showSection('product')">Produkt</button>
    <button class="btn btn-secondary" onclick="showSection('contact')">Kontakt</button>
  </div>
</header>

<div class="preorder">Just nu f√∂rbest√§llning</div>

<main>
  <section id="home">
    <div class="section-inner">
      <h2>V√§lkommen</h2>
      <p class="lead">To-Go Bag ‚Äî en smart n√∂dv√§ska f√∂r vardagens sm√• kriser. Klicka p√• Produkt f√∂r att best√§lla.</p>
    </div>
  </section>

  <section id="product">
    <div class="section-inner">
      <h2>The To-Go Bag</h2>
      <p class="lead">En liten v√§ska med handsprit, pl√•ster, h√•rsnoddar, binda/tampong, m√ºslibar, tuggummi och v√•tservetter.</p>

      <div class="product-card">
        <div>
          <p style="font-weight:800;margin:0 0 8px">The To-Go Bag</p>
          <p class="muted">Perfekt f√∂r skolan, festen eller n√§r du √§r p√• spr√•ng.</p>

          <div style="margin-top:14px">
            <label for="variantSelect">Variant</label>
            <select id="variantSelect">
              <option value="Binda/Tampong">Binda/Tampong</option>
              <option value="Herr">Herr</option>
            </select>

            <div id="subVariantWrap" style="margin-top:10px">
              <label for="subVariantSelect">V√§lj</label>
              <select id="subVariantSelect">
                <option value="Binda">Binda</option>
                <option value="Tampong">Tampong</option>
              </select>
            </div>

            <div style="margin-top:10px">
              <label for="colorSelect">F√§rg</label>
              <select id="colorSelect">
                <option value="Bl√•">Bl√•</option>
                <option value="Rosa">Rosa</option>
                <option value="Svart">Svart</option>
                <option value="Vit">Vit</option>
              </select>
            </div>

            <div style="margin-top:14px;display:flex;gap:12px;align-items:center">
              <!-- Price removed from button as requested -->
              <button id="orderBtn" class="btn btn-primary">L√§gg i varukorg</button>
              <div class="muted">Pris/st: <strong>85 kr</strong></div>
            </div>
            <div class="small">Variant &amp; val inkluderas i orderbekr√§ftelsen och Swish-meddelandet.</div>
          </div>
        </div>

        <div class="prod-visual">
          <div style="height:220px;display:flex;align-items:center;justify-content:center;color:#234;font-weight:700">Produktbild</div>
          <div style="margin-top:12px;font-weight:800;color:var(--navy)">85 kr</div>
        </div>
      </div>
    </div>
  </section>

  <section id="about">
    <div class="section-inner">
      <h2>Om oss</h2>
      <p class="lead">Vi √§r ett UF-f√∂retag som vill g√∂ra vardagen enklare med genomt√§nkta n√∂dv√§skor.</p>
    </div>
  </section>

  <section id="contact">
    <div class="section-inner">
      <h2>Kontakt</h2>
      <p>Mejla oss p√• <a href="mailto:togobaguf@gmail.com">togobaguf@gmail.com</a></p>
    </div>
  </section>
</main>

<!-- cart icon -->
<div id="cartIcon" title="Varukorg" onclick="openCart()">üõí <span id="cartCount">0</span></div>

<!-- CART MODAL -->
<div id="cartModalBackdrop" class="modal-backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true">
    <span class="closeX" id="closeCartBtn">&times;</span>
    <h3 style="margin-top:6px">Din varukorg</h3>
    <div id="cartItems" style="margin-top:12px"></div>

    <div class="summary" id="cartSummary" style="margin-top:12px">
      <div><strong>Totalt:</strong> <span id="cartTotal">0</span> kr</div>
    </div>

    <div style="display:flex;gap:10px;margin-top:14px">
      <button class="btn btn-secondary" onclick="closeCart()" style="flex:1">Forts√§tt handla</button>
      <button class="btn btn-primary" onclick="openCheckout()" style="flex:1">F√∂rbest√§ll / Checkout</button>
    </div>
  </div>
</div>

<!-- CHECKOUT MODAL -->
<div id="checkoutModalBackdrop" class="modal-backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true">
    <span class="closeX" id="closeCheckoutBtn">&times;</span>
    <img src="logo.png" alt="logo" class="logo-in-confirm" />
    <h3 style="margin-top:6px">Slutf√∂r best√§llning</h3>

    <form id="checkoutForm" style="margin-top:12px" onsubmit="return false;">
      <label for="name">Namn</label>
      <input id="name" type="text" required>

      <label for="email">E-post</label>
      <input id="email" type="email" required>

      <label for="phone">Telefonnummer (valfritt)</label>
      <input id="phone" type="text">

      <label for="address">Adress</label>
      <input id="address" type="text" required>

      <label for="postal">Postnummer</label>
      <input id="postal" type="text" required>

      <label for="city">Stad</label>
      <input id="city" type="text" required>

      <label for="shipping">Fraktmetod</label>
      <select id="shipping">
        <option value="Standard">Standard</option>
        <option value="Express">Express</option>
      </select>

      <div class="summary" id="checkoutSummaryBox" style="margin-top:12px">
        <div><strong>Order:</strong></div>
        <div id="checkoutItemsList" style="margin-top:8px" class="small"></div>
        <div style="margin-top:8px"><strong>Totalt:</strong> <span id="checkoutTotal">0</span> kr</div>
      </div>

      <button type="button" class="pay-btn" id="submitOrderBtn" onclick="submitOrder()">üí∏ Betala & F√∂rbest√§ll</button>

      <div style="margin-top:8px; text-align:center">
        <button type="button" id="manualSwishBtn" style="display:none;padding:8px 12px;border-radius:8px;border:1px solid #d6e9f7;background:#f8fbff;color:var(--navy);cursor:pointer">√ñppna Swish manuellt</button>
      </div>
    </form>
  </div>
</div>

<footer>
  <img src="logo.png" alt="logo" class="logo-small" />
  <div>¬© 2025 To-Go Bag UF ‚Äî Kontakt: <a style="color:#e6f2ff" href="mailto:togobaguf@gmail.com">togobaguf@gmail.com</a></div>
</footer>

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
/* ---------- KONFIG ---------- */
emailjs.init("ZUlGUNzP7Tqxg-LkD"); // public key
const EMAIL_SERVICE = "service_obk5jf2";
const EMAIL_TEMPLATE = "template_kj9rgm7";
const SWISH_NUMBER = "0764134947";
const PRICE = 85;

/* ---------- APP STATE ---------- */
/* cartItems = array of {id, variant, subVariant, color, qty} */
let cartItems = [];

/* ---------- INIT ---------- */
document.addEventListener('DOMContentLoaded', () => {
  showSection('home');
  document.getElementById('variantSelect').addEventListener('change', updateSubVariantVisibility);
  updateSubVariantVisibility();
  document.getElementById('closeCartBtn').addEventListener('click', closeCart);
  document.getElementById('closeCheckoutBtn').addEventListener('click', closeCheckout);
  document.getElementById('cartModalBackdrop').addEventListener('click', (e)=>{ if(e.target === document.getElementById('cartModalBackdrop')) closeCart(); });
  document.getElementById('checkoutModalBackdrop').addEventListener('click', (e)=>{ if(e.target === document.getElementById('checkoutModalBackdrop')) closeCheckout(); });

  document.getElementById('manualSwishBtn').addEventListener('click', function(){ if(window._lastSwishUrl) window.open(window._lastSwishUrl, '_blank'); });

  document.getElementById('orderBtn').addEventListener('click', addCurrentToCart);
});

/* ---------- SECTIONS ---------- */
function showSection(id){
  document.querySelectorAll('main section').forEach(s=>s.style.display='none');
  const sec = document.getElementById(id);
  if(sec) sec.style.display='block';
}

/* ---------- VARIANT UI ---------- */
function updateSubVariantVisibility(){
  const v = document.getElementById('variantSelect').value;
  document.getElementById('subVariantWrap').style.display = (v === 'Binda/Tampong') ? 'block' : 'none';
}

/* ---------- CART HANDLERS ---------- */
function addCurrentToCart(){
  const variant = document.getElementById('variantSelect').value;
  const subVariant = (variant === 'Binda/Tampong') ? document.getElementById('subVariantSelect').value : '';
  const color = document.getElementById('colorSelect').value;

  // If exact same variant+sub+color exists, increment qty (so repeated clicks increase qty)
  const existing = cartItems.find(i => i.variant===variant && i.subVariant===subVariant && i.color===color);
  if(existing){
    existing.qty += 1;
  } else {
    cartItems.push({
      id: Date.now() + Math.random().toString(36).slice(2,6),
      variant, subVariant, color, qty: 1
    });
  }
  updateCartUI();
  openCart();
}

function updateCartUI(){
  const area = document.getElementById('cartItems');
  if(!cartItems.length){ area.innerHTML = "<p>Din varukorg √§r tom.</p>"; document.getElementById('cartTotal').textContent = 0; document.getElementById('cartCount').textContent = 0; return; }

  document.getElementById('cartCount').textContent = cartItems.reduce((s,i)=>s+i.qty,0);

  let html = '';
  cartItems.forEach((item, idx) => {
    const subText = item.subVariant ? ` (${item.subVariant})` : '';
    html += `
      <div class="cart-item" data-index="${idx}">
        <div style="flex:1">
          <div style="font-weight:700">The To-Go Bag</div>
          <div class="muted">Variant: ${item.variant}${subText}</div>
          <div class="muted">F√§rg: ${item.color}</div>
        </div>
        <div style="text-align:right">
          <label for="qty_${item.id}">Antal</label>
          <input id="qty_${item.id}" class="qty-input" type="number" value="${item.qty}" min="1">
          <div style="margin-top:8px;font-weight:700">${PRICE * item.qty} kr</div>
          <div style="margin-top:6px"><button class="remove-btn" data-index="${idx}">Ta bort</button></div>
        </div>
      </div>
    `;
  });
  area.innerHTML = html;

  // attach listeners
  cartItems.forEach(item=>{
    const el = document.getElementById('qty_' + item.id);
    if(el){
      el.addEventListener('input', (e)=>{
        let v = parseInt(e.target.value);
        if(isNaN(v) || v < 1) v = 1;
        item.qty = v;
        updateCartUI();
      });
    }
  });
  // remove buttons
  area.querySelectorAll('.remove-btn').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      const idx = parseInt(btn.getAttribute('data-index'));
      cartItems.splice(idx,1);
      updateCartUI();
    });
  });

  const total = cartItems.reduce((s,i)=>s + (i.qty * PRICE), 0);
  document.getElementById('cartTotal').textContent = total;
  document.getElementById('cartCount').textContent = cartItems.reduce((s,i)=>s+i.qty,0);
}

/* open/close cart */
function openCart(){ updateCartUI(); document.getElementById('cartModalBackdrop').classList.add('open'); }
function closeCart(){ document.getElementById('cartModalBackdrop').classList.remove('open'); }

/* ---------- CHECKOUT ---------- */
function openCheckout(){
  if(!cartItems.length){ alert("Din varukorg √§r tom."); return; }
  // populate checkout summary
  const listEl = document.getElementById('checkoutItemsList');
  listEl.innerHTML = '';
  cartItems.forEach(it=>{
    const sub = it.subVariant ? ` (${it.subVariant})` : '';
    const row = `${it.qty} x ${it.variant}${sub} ‚Äî ${it.color} ( ${it.qty * PRICE} kr )`;
    const div = document.createElement('div'); div.textContent = row; listEl.appendChild(div);
  });
  document.getElementById('checkoutTotal').textContent = cartItems.reduce((s,i)=>s + i.qty*PRICE, 0);
  document.getElementById('checkoutModalBackdrop').classList.add('open');
}
function closeCheckout(){ document.getElementById('checkoutModalBackdrop').classList.remove('open'); }

/* ---------- SUBMIT ORDER (EmailJS + Swish) ---------- */
function submitOrder(){
  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const address = document.getElementById('address').value.trim();
  const postal = document.getElementById('postal').value.trim();
  const city = document.getElementById('city').value.trim();
  const shipping = document.getElementById('shipping').value;

  if(!name || !email || !address || !postal || !city){
    alert("Fyll i alla obligatoriska f√§lt: namn, e-post, adress, postnummer och stad.");
    return;
  }
  if(!cartItems.length){
    alert("Din varukorg √§r tom.");
    return;
  }

  // build items summary string for email and swish message
  const itemsSummary = cartItems.map(i=>{
    const sub = i.subVariant ? ` (${i.subVariant})` : '';
    return `${i.qty}√ó ${i.variant}${sub} ‚Äî ${i.color}`;
  }).join('; ');

  const total = cartItems.reduce((s,i)=>s + i.qty*PRICE, 0);

  // prepare emailjs params (include logo_url)
  const logo_url = `${window.location.origin}/logo.png`;
  const params = {
    name, email, phone, address, postal, city, shipping,
    items: itemsSummary,
    total,
    logo_url
  };

  // disable button
  const btn = document.getElementById('submitOrderBtn');
  btn.disabled = true; btn.textContent = "Skickar...";

  emailjs.send(EMAIL_SERVICE, EMAIL_TEMPLATE, params).then(()=>{
    // show confirmation with logo
    const modal = document.querySelector('#checkoutModalBackdrop .modal');
    modal.innerHTML = `
      <span class="closeX" onclick="closeCheckout()">&times;</span>
      <img src="logo.png" alt="logo" style="height:80px;display:block;margin:8px auto" />
      <h3>Tack! Din best√§llning √§r mottagen</h3>
      <div style="margin-top:10px">
        <p><strong>Namn:</strong> ${escapeHtml(name)}</p>
        <p><strong>E-post:</strong> ${escapeHtml(email)}</p>
        ${phone ? `<p><strong>Telefon:</strong> ${escapeHtml(phone)}</p>` : ''}
        <p><strong>Adress:</strong> ${escapeHtml(address)}, ${escapeHtml(postal)} ${escapeHtml(city)}</p>
        <p><strong>Frakt:</strong> ${escapeHtml(shipping)}</p>
        <p><strong>Produkter:</strong> ${escapeHtml(itemsSummary)}</p>
        <p><strong>Total:</strong> ${total} kr</p>
        <p style="margin-top:12px">Nu √∂ppnar vi Swish (funkar endast p√• mobil). Om Swish inte √∂ppnas automatiskt, klicka p√• knappen nedan.</p>
        <div style="margin-top:12px">
          <button id="manualSwishLink" style="background:#0b6bff;color:#fff;padding:10px 14px;border-radius:8px;border:0;cursor:pointer">√ñppna Swish manuellt</button>
        </div>
      </div>
    `;

    // set manual button action and try to open swish
    const message = encodeURIComponent(`To-Go Bag: ${itemsSummary} ‚Äî Totalt ${total}kr`);
    const callback = encodeURIComponent(window.location.href);
    const swishApp = `swish://paymentrequest?token=1&callbackurl=${callback}&payee=${SWISH_NUMBER}&amount=${total}&message=${message}`;
    const swishWeb = `https://swish.nu/?number=${SWISH_NUMBER}&amount=${total}&text=${message}`;

    window._lastSwishUrl = swishWeb;
    const manualBtn = document.getElementById('manualSwishLink');
    if(manualBtn) manualBtn.addEventListener('click', ()=> window.open(window._lastSwishUrl, '_blank'));

    // Try to open app (only mobile)
    if(/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)){
      const now = Date.now();
      // Use location change to open app
      window.location.href = swishApp;
      // fallback to web after short delay
      setTimeout(()=> {
        if(Date.now() - now < 3000){
          window.open(swishWeb, '_blank');
        }
      }, 1200);
    } else {
      // desktop fallback
      alert("Swish kan endast √∂ppnas automatiskt p√• mobil. Ett webbf√∂nster √∂ppnas med instruktioner.");
      window.open(swishWeb, '_blank');
    }

    // reset cart UI
    cartItems = [];
    updateCartUI();
    btn.disabled = false; btn.textContent = "üí∏ Betala & F√∂rbest√§ll";
  }, (err)=>{
    console.error(err);
    alert("Ett fel uppstod vid skickande av best√§llningen. F√∂rs√∂k igen.");
    btn.disabled = false; btn.textContent = "üí∏ Betala & F√∂rbest√§ll";
  });
}

/* ---------- UTIL ---------- */
function escapeHtml(unsafe){
  if(!unsafe) return '';
  return String(unsafe)
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;')
    .replace(/'/g,'&#039;');
}
</script>
</body>
</html>
